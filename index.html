<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title> PWA Simple</title>
    <meta name="theme-color" content="#0891b2">
    <meta name="theme-author" content="Melisa Mercado Vargas 7CM1">
    <!--MANIFEST-->
    <link rel="manifest" id="manifest">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
    </style>
</head>

<script type="text/javascript">
    !function(T,l,y){var S=T.location,k="script",D="instrumentationKey",C="ingestionendpoint",I="disableExceptionTracking",E="ai.device.",b="toLowerCase",w="crossOrigin",N="POST",e="appInsightsSDK",t=y.name||"appInsights";(y.name||T[e])&&(T[e]=t);var n=T[t]||function(d){var g=!1,f=!1,m={initialize:!0,queue:[],sv:"5",version:2,config:d};function v(e,t){var n={},a="Browser";return n[E+"id"]=a[b](),n[E+"type"]=a,n["ai.operation.name"]=S&&S.pathname||"_unknown_",n["ai.internal.sdkVersion"]="javascript:snippet_"+(m.sv||m.version),{time:function(){var e=new Date;function t(e){var t=""+e;return 1===t.length&&(t="0"+t),t}return e.getUTCFullYear()+"-"+t(1+e.getUTCMonth())+"-"+t(e.getUTCDate())+"T"+t(e.getUTCHours())+":"+t(e.getUTCMinutes())+":"+t(e.getUTCSeconds())+"."+((e.getUTCMilliseconds()/1e3).toFixed(3)+"").slice(2,5)+"Z"}(),iKey:e,name:"Microsoft.ApplicationInsights."+e.replace(/-/g,"")+"."+t,sampleRate:100,tags:n,data:{baseData:{ver:2}}}}var h=d.url||y.src;if(h){function a(e){var t,n,a,i,r,o,s,c,u,p,l;g=!0,m.queue=[],f||(f=!0,t=h,s=function(){var e={},t=d.connectionString;if(t)for(var n=t.split(";"),a=0;a<n.length;a++){var i=n[a].split("=");2===i.length&&(e[i[0][b]()]=i[1])}if(!e[C]){var r=e.endpointsuffix,o=r?e.location:null;e[C]="https://"+(o?o+".":"")+"dc."+(r||"services.visualstudio.com")}return e}(),c=s[D]||d[D]||"",u=s[C],p=u?u+"/v2/track":d.endpointUrl,(l=[]).push((n="SDK LOAD Failure: Failed to load Application Insights SDK script (See stack for details)",a=t,i=p,(o=(r=v(c,"Exception")).data.baseData).exceptions=[{typeName:"SDKLoadFailed",message:n.replace("."," -"),hasFullStack:!1,stack:n+"\nSnippet failed to load ["+a+"] -- Telemetry is disabled\nHelp Link: https://go.microsoft.com/fwlink/?linkid=2128109\nHost: "+(S&&S.pathname||"_unknown_")+"\nEndpoint: "+i,parsedStack:[]}],r)),l.push(function(e,t,n,a){var i=v(c,"Message"),r=i.data.baseData;return r.message='AI (Internal): 99 message:"'+("SDK LOAD Failure: Failed to load Application Insights SDK script (See stack for details) ("+n+")").replace(/\"/g,"")+'"',r.properties={endpoint:a},i}(0,0,t,p)),function(e,t){if(JSON){var n=T.fetch;if(n&&!y.useXhr)n(t,{method:N,body:JSON.stringify(e),mode:"cors"});else if(XMLHttpRequest){var a=new XMLHttpRequest;a.open(N,t),a.setRequestHeader("Content-type","application/json"),a.send(JSON.stringify(e))}}}(l,p))}function i(e,t){f||setTimeout(function(){!t&&m.core||a()},500)}var r=function(){var n=l.createElement(k);n.src=h;var e=y[w];return!e&&""!==e||"undefined"==n[w]||(n[w]=e),n.onload=i,n.onerror=a,n.onreadystatechange=function(e,t){"loaded"!==n.readyState&&"complete"!==n.readyState||i(0,t)},n}();y.ld<0?l.getElementsByTagName("head")[0].appendChild(r):setTimeout(function(){l.getElementsByTagName(k)[0].parentNode.appendChild(r)},y.ld||0)}try{m.cookie=l.cookie}catch(p){}function t(e){for(;e.length;)!function(t){m[t]=function(){var e=arguments;g||m.queue.push(function(){m[t].apply(m,e)})}}(e.pop())}var n="track",r="TrackPage",o="TrackEvent";t([n+"Event",n+"PageView",n+"Exception",n+"Trace",n+"DependencyData",n+"Metric",n+"PageViewPerformance","start"+r,"stop"+r,"start"+o,"stop"+o,"addTelemetryInitializer","setAuthenticatedUserContext","clearAuthenticatedUserContext","flush"]),m.SeverityLevel={Verbose:0,Information:1,Warning:2,Error:3,Critical:4};var s=(d.extensionConfig||{}).ApplicationInsightsAnalytics||{};if(!0!==d[I]&&!0!==s[I]){var c="onerror";t(["_"+c]);var u=T[c];T[c]=function(e,t,n,a,i){var r=u&&u(e,t,n,a,i);return!0!==r&&m["_"+c]({message:e,url:t,lineNumber:n,columnNumber:a,error:i}),r},d.autoExceptionInstrumented=!0}return m}(window,document,{
    src: "https://js.monitor.azure.com/scripts/b/ai.2.min.js", 
    cfg: {
        connectionString: "InstrumentationKey=b85b0aa3-dfb0-4c0f-bb9a-1bd90ff61812;IngestionEndpoint=https://westus2-2.in.applicationinsights.azure.com/;LiveEndpoint=https://westus2.livediagnostics.monitor.azure.com/;ApplicationId=a17e4f4b-9572-46ad-a502-56eb5ef7e073"
    }});
    const manifestJSON = {
            "name": "Progressive Web App Simple",
            "short_name": "PWA Simple",
            "start_url": ".",
            "display": "standalone",
            "background_color": "#f3f4f6",
            "theme_color": "#0891b2",
            "description": "Una aplicación web progresiva de ejemplo.",
            "icons": [
                {
                    "src": "https://placehold.co/192x192/0891b2/ffffff?text=PWA",
                    "sizes": "192x192",
                    "type": "image/png",
                    "purpose": "any maskable"
                },
                {
                    "src": "https://placehold.co/512x512/0891b2/ffffff?text=PWA",
                    "sizes": "512x512",
                    "type": "image/png",
                    "purpose": "any maskable"
                }
            ]
        };

        //crea un blob con el contenido del manifest y lo asigna al link
        //blob = Objeto Binario Grande (Binary Large Object) que representa datos de tipo archivo
        const manifestBlob = new Blob([JSON.stringify(manifestJSON)], { type: 'application/json' });
        const manifestURL = URL.createObjectURL(manifestBlob);
        document.querySelector('#manifest').setAttribute('href', manifestURL);

        //registra el service worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                // se le dice al navegador donde está el service worker
                navigator.serviceWorker.register('sw.js') 
                    .then(registration => {
                        console.log('ServiceWorker registrado con éxito. Scope:', registration.scope);
                        document.getElementById('status').textContent = 'La app ya puede funcionar sin conexión.';
                    })
                    .catch(err => {
                        console.error('Fallo en el registro del ServiceWorker:', err);
                        document.getElementById('status').textContent = 'Error al preparar la app para uso sin conexión.';
                    });
            });
        } else {
            console.warn('Service workers no soportados en este navegador.');
            document.getElementById('status').textContent = 'Tu navegador no soporta las funciones sin conexión.';
        }

        //inidcación del estado de la conexión
        const connectionStatusEl = document.getElementById('connection-status');

        function updateConnectionStatus() {
            if (navigator.onLine) {
                connectionStatusEl.textContent = 'Estás en línea';
                connectionStatusEl.classList.remove('bg-gray-200', 'text-gray-700');
                connectionStatusEl.classList.add('bg-green-100', 'text-green-800');
            } else {
                connectionStatusEl.textContent = 'Estás sin conexión';
                connectionStatusEl.classList.remove('bg-green-100', 'text-green-800');
                connectionStatusEl.classList.add('bg-gray-200', 'text-gray-700');
            }
        }
        //actualiza y escucha cambios en el estado de la conexión
        updateConnectionStatus();
        window.addEventListener('online', updateConnectionStatus);
        window.addEventListener('offline', updateConnectionStatus);

            const postTitleEl = document.getElementById('post-title');
            const postBodyEl = document.getElementById('post-body');
            const fetchPostBtn = document.getElementById('fetch-post-btn');

            async function fetchPost() {
                const postId = Math.floor(Math.random() * 5) + 1;
                const apiUrl = `https://jsonplaceholder.typicode.com/posts/${postId}`;

                postTitleEl.textContent = 'Cargando...';
                postBodyEl.textContent = '';

                try {
                    //petición a la API
                    const response = await fetch(apiUrl);
                    if (!response.ok) {
                        throw new Error(`Error HTTP: ${response.status}`);
                    }
                    const post = await response.json();

                    postTitleEl.textContent = post.title;
                    postBodyEl.textContent = post.body;

                } catch (error) {
                    console.error('No se pudo obtener el post:', error);
                    postTitleEl.textContent = 'Error al cargar el post';
                    postBodyEl.textContent = 'Inténtalo de nuevo más tarde.';
                }
            }
            //event listener para el botón
            fetchPostBtn.addEventListener('click', fetchPost);
            //carga un post al iniciar
            document.addEventListener('DOMContentLoaded', fetchPost);
</script>
<body class="bg-gray-100 font-sans flex items-center justify-center min-h-screen">

    <div class="container mx-auto p-4 max-w-md w-full">
        <div class="bg-white rounded-xl shadow-lg p-6 md:p-8 text-center">
            
            <div class="flex justify-center mb-4">
                <div class="w-20 h-20 bg-cyan-600 rounded-2xl flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-white" fill="none" viewBox="0 0 24 24" 
                    stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 
                        00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z" />
                    </svg>
                </div>
            </div>

            <h1 class="text-3xl font-bold text-gray-800 mb-2">Progressive Web Apps</h1>
            <p class="text-gray-600 mb-6">
                Esta aplicación funciona sin conexión.
            </p>

            <!-- Estado del Service Worker -->
            <div id="status" class="bg-cyan-50 text-cyan-700 rounded-lg p-3 text-sm font-medium">
                Verificando estado...
            </div>
        </div>
        <!-- Status de conexión -->
        <div id="connection-status" class="mt-4 rounded-lg p-3 text-sm font-medium flex items-center justify-center">
        </div>

        <div class="mt-8 p-6 bg-white rounded-xl shadow-lg w-full">
        <h2 class="text-xl font-bold text-gray-800 mb-4">Post desde API de Prueba</h2>
        <div id="post-container" class="bg-gray-50 p-4 rounded-lg border">
            <h3 id="post-title" class="text-lg font-semibold text-cyan-800">Cargando título...</h3>
            <p id="post-body" class="text-gray-700 mt-2">Cargando contenido...</p>
        </div>
        <button id="fetch-post-btn" class="mt-4 w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg transition-colors">
            Cargar Nuevo Post
        </button>
    </div>
    </div>
</body>
</html>
